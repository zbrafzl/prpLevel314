@{
    ViewBag.Title = "Application Voucher";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model Prp.Sln.ProfileModelEmpty
@section RenderCss{
    <link href="/assets/css/BreadCrumb.css" rel="stylesheet" />
    <style>
        .div-table {
            width: 98%;
            margin: 0% 1%;
        }
    </style>

}
@section RenderScript{

    <script>

        var applicantId = 0, applicantVoucherId = 0, imagesPath = ""
            , objApplicant = {}, objApplicantInfo = {}, objVoucher = {}, countryId = 132;

        $(document).ready(function () {

            applicantId = ConvertToInt($("#hfdApplicantId").val());
            imagesPath = "/Images/Applicant/" + applicantId + "/";

            var startDate = new Date(2023, 12 - 1, 6);
            var endDate = new Date(2023, 12 - 1, 19);

            var dateFormatDatePocker = 'dd/mm/yyyy';

            $(".txtSubmittedDate").datepicker({
                format: dateFormatDatePocker,
                autoclose: true,
                clearBtn: true,
                disableTouchKeyboard: true,
                //todayHighlight: true,
                showOnFocus: true,
                changeYear: true,
                startDate: startDate,
                endDate: endDate
            });

            $(document).on('click', '#chkSubmittedVoucher', function () {
                var status = $("#chkSubmittedVoucher").is(':checked');

                $("#divVoucherForm").hide();
                $("#divPaymentForm").hide();

                if (status == true) {
                    $("#divVoucherForm").show();
                    $("#divPaymentForm").hide();
                }
                else {

                    $("#divVoucherForm").hide();
                    $("#divPaymentForm").show();
                }
            });

            $(document).on('click', '.btnSave', function () {
                SaveAndProceed();
            });

            $(document).on('click', '#ankVoucherDownload', function () {
                sessionStorage.setItem("applicantIdPrint", applicantId);
                window.open('/print/voucher', '_blank');
            });

            $(document).on('click', '.ankVoucherLink', function () {
                BindVoucherForm();
            });


            $(document).keypress(function (event) {
                var keycode = (event.keyCode ? event.keyCode : event.which);
                if (keycode == '13') {
                    SaveAndProceed();
                }
            });

            $(document).on('click', '#ankContinue', function () {

                if (applicantVoucherId > 0) {

                    CallActionGet("/ApplicantProfile/UpdateApplicantStatus?applicantId=" + applicantId
                        + "&applicationStatus=7&condition=applicationStatus");

                    window.location = "/applicant-proof-reading";
                }
                else {

                    alert("Please add payment information")
                }
            });


            ProfileProcessGetVoucher();

        });

        function ProfileProcessGetVoucher() {
            var resp = ProfileProcessGetInfoByParam(6);
            try {
                if (resp != null) {
                    BindFormPreInit(resp);
                }
            } catch (e) {
            }
            TrimLengthCtrl();
        }

        function BindFormPreInit(resp) {

            var objAppInfo = resp.Table25[0];
            var objVoucherBank = resp.Table26[0];
            var objVoucherApplicant = resp.Table28[0];

            countryId = objAppInfo.countryId;
            /*
            if (objAppInfo.countryId == 132) {
                $("#divPaymentForm").remove();
                $("#divDepositSlip").remove();
                $("#divGridPayment").remove();

                if (objVoucherBank.applicantId == 0) {
                    $("#btnSaveVoucher").remove();
                }
                $("#divVoucherForm").show();
            }
            else {

                $("#divDepositSlip").show();
            }

            if (objVoucherApplicant.applicantVoucherId == 0) {
                $("#ankContinue").remove();
            }*/

            $("#divDepositSlip").show();

            GetApplicantVoucherInfo(objVoucherApplicant);

        }

        function SaveAndProceed() {

            if (ValidateForm() == false) {

                var resp = CallActionPost("/ApplicantProfile/ApplicantVoucherAddUpdate", objVoucher);
                if (resp != null && resp.status == true) {
                    GetApplicantVoucherInfo();
                    //alert("Voucher information saved sucessfully.");
                    $("#ankContinue").click();
                }
                else {
                    alert(resp.msg);
                }

            }
        }

        function ValidateForm() {

            var isError = false, ctrl = "";
            objVoucher = {};

            $(".req-fld").removeClass("req-fld");
            $(".lbl-err").hide();

            /* Get Values
           *****************************************************************************/
            objVoucher.applicantVoucherId = applicantVoucherId;

            objVoucher.applicantId = applicantId;
            objVoucher.amount = "1000";
            objVoucher.branchCode = "";
            objVoucher.voucherImage = "";
            objVoucher.ibn = "";
            objVoucher.accountNo = "";
            objVoucher.accountTitle = "";
            objVoucher.dateSubmitted = "";

            var  status = $("#chkSubmittedVoucher").is(':checked');

            if (status == true) {

                objVoucher.branchCode = ConvertToString($("#txtBranchCode").val());

                if ($("#flVoucher").val()) {
                    objVoucher.voucherImage = UploadImage("flVoucher", applicantId, "voucher");
                    $("#hfdVoucher").val(objVoucher.voucherImage);
                }
                objVoucher.voucherImage = ConvertToString($("#hfdVoucher").val());

                objVoucher.dateSubmitted = "";
                if (ValidateDate("txtSubmittedDateVoucher")) {
                    objVoucher.dateSubmitted = ConvertToString($("#txtSubmittedDateVoucher").val());
                }

                if (objVoucher.branchCode == "") {
                    $("#txtBranchCode").addClass("req-fld");
                    ctrl = "txtBranchCode";
                    isError = true;
                }
                if (objVoucher.voucherImage == "") {

                    $("#flVoucher").addClass("req-fld");
                    isError = true;
                    if (ctrl == "")
                        ctrl = "flVoucher";
                }


                if (objVoucher.dateSubmitted == "") {
                    $("#txtSubmittedDateVoucher").addClass("req-fld");
                    isError = true;
                    if (ctrl == "")
                        ctrl = "txtSubmittedDateVoucher";
                }

            }
            else {


                objVoucher.ibn = ConvertToString($("#txtIBN").val());
                objVoucher.accountNo = ConvertToString($("#txtAccountNo").val());
                objVoucher.accountTitle = ConvertToString($("#txtAccountTitle").val());

                objVoucher.dateSubmitted = "";
                if (ValidateDate("txtSubmittedDatePayment")) {
                    objVoucher.dateSubmitted = ConvertToString($("#txtSubmittedDatePayment").val());
                }

                if (objVoucher.ibn == "") {
                    $("#txtIBN").addClass("req-fld");
                    ctrl = "txtIBN";
                    isError = true;
                }
                if (objVoucher.accountNo == "") {
                    $("#txtAccountNo").addClass("req-fld");
                    isError = true;
                    if (ctrl == "")
                        ctrl = "txtAccountNo";
                }
                if (objVoucher.accountTitle == "") {
                    $("#txtAccountTitle").addClass("req-fld");
                    isError = true;
                    if (ctrl == "")
                        ctrl = "txtAccountTitle";
                }

                if (objVoucher.dateSubmitted == "") {
                    $("#txtSubmittedDatePayment").addClass("req-fld");
                    isError = true;
                    if (ctrl == "")
                        ctrl = "txtSubmittedDatePayment";
                }

            }


            if (ctrl != "")
                $("#" + ctrl).focus();

            return isError;
        }

        function GetApplicantVoucherInfo(objVoucherApplicant) {

            applicantVoucherId = 0;
            $("#divVoucherForm").hide();
            $("#divPaymentForm").hide();
            $("#divGridVoucher").hide();
            $("#divGridPayment").hide();

            objVoucher = objVoucherApplicant;
            if (objVoucher != null && objVoucher.applicantVoucherId > 0) {

                applicantVoucherId = objVoucher.applicantVoucherId;

                $("#chkSubmittedVoucher").prop("checked", false);


                if (objVoucher.ibn != "")
                    $("#chkSubmittedVoucher").prop("checked", true);

                if (objVoucher.voucherImage.length > 0) {
                    
                    $("#divGridVoucher").show();
                    $("#tdBranchCode").html(objVoucher.branchCode);
                    $("#tdSubmittedDate").html(ToDateFormatDDMMYYYWithSlash(objVoucher.submittedDate));
                    if (objVoucher.voucherImage.length > 0) {
                        $('#tdImgVoucher').attr('src', imagesPath + objVoucher.voucherImage);
                        $('.ankImgVoucher').attr('href', imagesPath + objVoucher.voucherImage);
                    }
                }
                else {

                    $("#divGridPayment").show();
                    $("#tdIBN").html(objVoucher.ibn);
                    $("#tdAccountNo").html(objVoucher.accountNo);
                    $("#tdAccountTitle").html(objVoucher.accountTitle);
                    $("#tdSubmittedDate").html(ToDateFormatDDMMYYYWithSlash(objVoucher.submittedDate));
                }
            }
            else {

                //$("#chkSubmittedVoucher").prop("checked", true);
                $("#divVoucherForm").show();
                $("#divPaymentForm").hide();

            }
        }

        function BindVoucherForm() {

            if (objVoucher != null && objVoucher.applicantVoucherId > 0) {

                applicantVoucherId = objVoucher.applicantVoucherId;

                $("#chkSubmittedVoucher").prop("checked", false);

                if (objVoucher.voucherImage.length > 0) {

                    $("#chkSubmittedVoucher").prop("checked", true);

                    $("#divVoucherForm").show();

                    $("#txtBranchCode").val(objVoucher.branchCode);
                    $("#hfdVoucher").val(objVoucher.voucherImage);

                    $("#txtSubmittedDateVoucher").val(ToDateFormatDDMMYYYWithSlash(objVoucher.submittedDate));

                    if (objVoucher.voucherImage.length > 0) {
                        $('#imgVoucher').attr('src', imagesPath + objVoucher.voucherImage);
                        $('#imgVoucher').show();
                        $('#rmvVoucher').show();
                        $("#hfdVoucher").val(objVoucher.voucherImage);
                    }

                }
                else {

                    $("#divPaymentForm").show();
                    $("#txtIBN").val(objVoucher.ibn);
                    $("#txtAccountTitle").val(objVoucher.accountTitle);
                    $("#txtAccountNo").val(objVoucher.accountNo);
                    $("#txtSubmittedDatePayment").val(ToDateFormatDDMMYYYWithSlash(JsonToDate(objVoucher.submittedDate)));

                }

            }
        }

    </script>

}

<div class="container divProfile" style=" margin-bottom:60px;">
    <div class="row main">
        <div class="col-sm-12 form-box">
            <div class="main-login main-center">
                <div class="row">
                    <div class="col-sm-12">
                        @Html.Partial("_ProfileLinks")
                        <h3>Payment  Information</h3>
                        <hr class="colorgraph">
                        <div id="divGridVoucher" class="row" style="display:none;">
                            <div class="col-xs-12 col-sm-12 col-md-12">
                                <table class="table mt10">
                                    <thead class="job-th">
                                        <tr>
                                            <th style="width:24.5%">Brach Code</th>
                                            <th style="width:24.5%">Submitted Date</th>
                                            <th style="width:24.5%">Voucher</th>
                                            <th style="width:24.5%">Edit</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="job-tb">
                                            <td id="tdBranchCode"></td>
                                            <td id="tdSubmittedDate">  </td>
                                            <td> <img id="tdImgVoucher" class="flup-img" src="" alt="" />  </td>
                                            <td>  <a id="ankVoucher" class="ank ankVoucherLink"><i class="fa fa-edit "></i></a> </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div id="divGridPayment" class="row" style="display:none;">
                            <div class="col-xs-12 col-sm-12 col-md-12">
                                <table class="table mt10">
                                    <thead class="job-th">
                                        <tr>
                                            <th style="width:19.5%">IBN</th>
                                            <th style="width:19.5%">Account No</th>
                                            <th style="width:19.5%">Account Title</th>
                                            <th style="width:19.5%">Submitted Date</th>
                                            <th style="width:19.5%">Edit</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="job-tb">
                                            <td id="tdIBN"></td>
                                            <td id="tdAccountNo"></td>
                                            <td id="tdAccountTitle"></td>
                                            <td id="tdSubmittedDate">   </td>
                                            <td>  <a id="ankVoucher" class="ank ankVoucherLink"><i class="fa fa-edit "></i></a> </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="well">
                            <form role="form">
                                <div id="divDownload" class="row">
                                    <div class="col-xs-12 col-sm-12 col-md-12">
                                        <div class="form-group">
                                            <a class="ank" id="ankVoucherDownload"> <i class="fa fa-download "></i> Generate &amp; Download Fee Voucher</a>
                                        </div>
                                    </div>
                                </div>
                                <div id="divDepositSlip" class="row" style="display:none;">
                                    <div class="col-md-12" style="padding: 20px 15px; ">
                                        <label style="word-wrap: break-word; line-height: 16px; float: left;" for="chkForeignNational">
                                            <input type="checkbox" name="checkbox" id="chkSubmittedVoucher" value="Foriegn_National" style="float: left;margin: 0px 5px;height: 18px;width: 20px;">
                                            In Case you deposited(voucher) fee in Bank of punjab.
                                        </label>
                                    </div>
                                </div>
                                <div id="divVoucherForm" class="row" style="display:none;">
                                    <div class="col-xs-12 col-sm-3 col-md-3">
                                        <div class="form-group">
                                            <span style="color:red">*</span>
                                            <label> Branch Code</label>
                                            <input required="required" type="text" name="txtBranchCode" id="txtBranchCode" class="form-control numeric " len="4" tabindex="1">
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-3 col-md-3">
                                        <div class="form-group">
                                            <span style="color:red">*</span>
                                            <label for=""> Submit Date </label>
                                            <input required="required" type="text" name="txtSubmittedDateVoucher" id="txtSubmittedDateVoucher" class="form-control datepicker txtSubmittedDate" tabindex="1">
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-4 col-md-4">
                                        <div class="form-group">
                                            <span style="color:red">*</span>
                                            <label for="flVoucher"> Voucher Image </label>
                                            <input type="file" class="form-control flup" name="flVoucher" id="flVoucher" tabindex="18" />
                                            <input type="hidden" id="hfdVoucher" value="" />
                                            <img id="imgVoucher" class="flup-img" src="" alt="" style="display:none;" />
                                            <a id="rmvVoucher" class="removeImage" style="display:none;"> <i class="fa fa-window-close"></i> Remove</a>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-2 col-md-2">
                                        <div class="form-group">
                                            <label>&nbsp;</label>
                                            <input type="button" id="btnSaveVoucher" name="submit" class="btn mybtn animated-button form-control btnSave" value="Save" />
                                        </div>
                                    </div>
                                </div>
                                <div id="divPaymentForm" class="row" style="display:none;">
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-6 col-md-6">
                                            <div class="form-group">
                                                <span style="color:red">*</span>
                                                <label for=""> IBN </label>
                                                <input required="required" type="text" name="txtIBN" id="txtIBN" class="form-control lenth" len="25" tabindex="1">
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-6 col-md-6">
                                            <div class="form-group">
                                                <span style="color:red">*</span>
                                                <label for=""> Applicant Account No. </label>
                                                <input required="required" type="text" name="txtAccountNo" id="txtAccountNo" class="form-control lenth" len="20" tabindex="1">
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-6 col-md-6">
                                            <div class="form-group">
                                                <span style="color:red">*</span>
                                                <label for=""> Applicant Account Title </label>
                                                <input required="required" type="text" name="txtAccountTitle" id="txtAccountTitle" class="form-control alpha" len="100" tabindex="1">
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-4 col-md-4">
                                            <div class="form-group">
                                                <span style="color:red">*</span>
                                                <label for=""> Submit Date </label>
                                                <input required="required" type="text" name="txtSubmittedDatePayment" id="txtSubmittedDatePayment" class="form-control datepicker txtSubmittedDate" tabindex="1">
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-2 col-md-2">
                                            <div class="form-group">
                                                <label>&nbsp;</label>
                                                <input type="button" id="btnSavePayment" name="submit" class="btn mybtn animated-button form-control btnSave" value="Save" />
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-2">
            </div>
            <div class="col-sm-4">
            </div>
            <div class="col-sm-6">
                <a id="ankContinue" href="#" class="btn btn-lg mb10 mt5 pull-right btn-red next-prev" typeId="6"> Continue &nbsp;&nbsp;<i class="fa fa-arrow-right"></i></a>
                &nbsp;&nbsp;
                <a id="ankPrev" href="#" class="btn btn-lg mb10 mt5 pull-right btn-blue next-prev" style="margin-right:10px; margin-top: 6px;"> <i class="fa fa-arrow-left"></i> &nbsp;&nbsp;Previous &nbsp;&nbsp;</a>
            </div>
            @Html.Partial("_NotePageBottom")
        </div>
    </div>
</div>