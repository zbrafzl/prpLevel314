@{
    ViewBag.Title = "Applicant List";
    Layout = "~/Areas/nadmin/Views/Shared/_Layout.cshtml";
}
@model Prp.Sln.ApplicantStatusModel
@section RenderCss{

    <style>
        .imgView {
            height: 50px;
            width: 45px;
        }
    </style>

}
@section RenderScript{

    <script>
        var countryTypeId = 0, perPageRecords = 50, statusId = 0
            , totalCount = 0, obj = {}, inductionId = 0;
        $(document).ready(function () {

            statusId = ConvertToInt($("#hfdStatusId").val());
            inductionId = ConvertToInt($("#hfdInductionId").val());
            $("#ddlStatus").val(statusId);

            if (inductionId == 0)
                $(".indc").show();
            else $(".indc").hide();

            pageNo = 1;
            SearchApplicant();


            $(document).on('click', '.tbRow', function () {

                if (userTypeId != 69) {

                    var applicantId = ConvertToInt($(this).attr("appId"));
                    var statusTypeId = ConvertToInt($("#hfdStatusTypeId").val());
                    var indcId = ConvertToInt($(this).attr("indcId"));

                    //
                    var url = "";
                    if (statusTypeId == 73) {

                        url = "/admin/voucher-detail?applicantId=" + applicantId;
                    }
                    else {

                        url = "/admin/applicant-detail-induction-" + indcId + "?key=applicantId&value=" + applicantId;

                    }
                    window.open(url, '_blank');
                }
            });


            $(document).on('click', '#btnSearch', function () {
                pageNo = 1;
                SearchApplicant();
            });

            $(document).keypress(function (event) {
                var keycode = (event.keyCode ? event.keyCode : event.which);
                if (keycode == '13') {
                    pageNo = 1;
                    SearchApplicant();
                }
            });

        });

        var listSubmittedApplicant = [];

        function SearchApplicant() {

            searchFunction = "SearchApplicant";

            var rowHtml = "";

            $("#tbPanel").html("");
            obj = {};
            obj.top = perPageRecords;
            obj.pageNum = pageNo;
            obj.statusTypeId = ConvertToInt($("#hfdStatusTypeId").val());
            obj.statusId = ConvertToInt($("#hfdStatusId").val());
            obj.inductionId = ConvertToInt($("#hfdInductionId").val());
            obj.name = ConvertToString($("#txtName").val());
            obj.emailId = ConvertToString($("#txtEmail").val());
            obj.contactNumber = ConvertToString($("#txtContactNo").val());
            obj.pmdcNo = ConvertToString($("#txtPmdcNo").val());
            obj.search = ConvertToString($("#txtSearch").val());


            var url = "/ApplicantAdmin/ApplicantSearchSimple";

            var resp = CallActionPost(url, obj);

            var html = "";

            var singleHtml = "", objItem = {};

            if (obj.statusTypeId != 131) {
                $(".displayComments").hide();
            }

            list = resp.Table;

            listSubmittedApplicant = resp.Table1;
            if (list != null && list.length > 0) {

                totalCount = list[0].totalCount;


                //$("#divDownload").show();
                rowHtml = $("#tbTempHtml").html();

                for (var i = 0; i < list.length; i++) {

                    objItem = list[i];
                    singleHtml = rowHtml;

                    html = html + singleHtml.replace(/{#rowNum#}/g, objItem.rowNum)
                        .replace(/{#applicantId#}/g, objItem.applicantId).replace(/{#pic#}/g, objItem.pic)
                        .replace(/{#name#}/g, objItem.name).replace(/{#pmdcNo#}/g, objItem.pmdcNo)
                        .replace(/{#emailId#}/g, objItem.emailId).replace(/{#contactNumber#}/g, objItem.contactNumber)
                        .replace(/{#fatherName#}/g, objItem.fatherName).replace(/{#cnicNo#}/g, objItem.cnicNo)
                        .replace(/{#facultyName#}/g, objItem.facultyName).replace(/{#dated#}/g, objItem.dated)
                        .replace(/{#status#}/g, objItem.status).replace(/{#dateStatus#}/g, objItem.dateStatus)
                        .replace(/{#comments#}/g, objItem.comments).replace(/{#statusType#}/g, objItem.statusType)
                        .replace(/{#induction#}/g, objItem.induction).replace(/{#inductionId#}/g, objItem.inductionId);
                }

                $("#tblPanel").show();
                $("#tbPanel").html(html);

                if (totalCount > 0)
                    CreatePaginationHtml(perPageRecords, totalCount, pageNo);
            }
            else {
                $("#tblPanel").hide();
                $("#tbPanel").html("");
            }

            //VerifyPmdcNo();
        }

        function VerifyPmdcNo() {
            var objApp = {};
            if (listSubmittedApplicant != null && listSubmittedApplicant.length > 0) {
                for (var i = 0; i < listSubmittedApplicant.length; i++) {
                    objApp = listSubmittedApplicant[i];
                    CheckAndVerifyPMDC(objApp.pmdcNo, inductionId, objApp.applicantId);
                }
            }
        }


    </script>
}

<div class="col-md-12 col-sm-12  ">
    <div class="x_panel">
        @Html.HiddenFor(m => m.statusTypeId, new { @id = "hfdStatusTypeId" })
        @Html.HiddenFor(m => m.statusId, new { @id = "hfdStatusId" })
        @Html.HiddenFor(m => m.inductionId, new { @id = "hfdInductionId" })
        @Html.HiddenFor(m => m.phaseId, new { @id = "hfdPhaseId" })
        <div class="x_title">
            <h2>Applicant List </h2>
            <div class="clearfix"></div>
        </div>
        <form class="form-horizontal form-label-left input_mask">
            <div class="form-group col-lg-12">
                <div class="col-md-3 col-sm-3 col-xs-3">
                    <label for="heard">Name :</label>
                    <input type="text" id="txtName" name="txtName" placeholder="Applicant Name" class="form-control" />
                </div>
                <div class="col-md-3 col-sm-3 col-xs-3">
                    <label for="heard">Email :</label>
                    <input type="text" id="txtEmail" name="txtEmail" placeholder="Email" class="form-control" />
                </div>
                <div class="col-md-3 col-sm-3 col-xs-3">
                    <label for="heard">Cell No :</label>
                    <input type="text" id="txtContactNo" name="txtContactNo" placeholder="Cell No" class="form-control" />
                </div>
                <div class="col-md-3 col-sm-3 col-xs-3">
                    <label for="heard">PMDC No :</label>
                    <input type="text" id="txtPmdcNo" name="txtPmdcNo" placeholder="Pmdc No" class="form-control" />
                </div>
                <div class="col-md-9 col-sm-9 col-xs-9">
                    <label for="heard">Search :</label>
                    <input type="text" id="txtSearch" name="txtSearch" placeholder="father name,CNIC" class="form-control" />
                </div>
                <div class="col-md-2 col-sm-2 col-xs-2">
                    <label for="heard" style="width:100%;">&nbsp;</label>
                    <input type="button" id="btnSearch" name="btnSearch" value="Search" class="btn btn-success" />
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="ln_solid"></div>
        </form>
        <div class="x_content">
            <div class="table-responsive">
                <table id="tblPanel" class="table table-striped jambo_table bulk_action" style="display:none;">
                    <thead>
                        <tr class="headings">
                            <th class="column-title">Sr. </th>
                            <th class="column-title">Pic </th>
                            <th class="column-title indc">Induction </th>
                            <th class="column-title">ID </th>
                            <th class="column-title">Name </th>
                            <th class="column-title">Father Name</th>
                            <th class="column-title">PMDC </th>
                            <th class="column-title">Email </th>
                            <th class="column-title">Number </th>
                            <th class="column-title">Cnic/PPNo</th>
                            <th class="column-title">Faculty</th>
                            <th class="column-title indc">Status Type </th>
                            <th class="column-title">Status </th>
                            <th class="column-title displayComments">Comments </th>
                            <th class="column-title">Dated </th>
                            <th class="column-title">Status Date </th>
                            <th class="column-title">Action </th>
                        </tr>
                    </thead>
                    <tbody id="tbPanel">
                    </tbody>
                </table>
                <div id="divPagination" style="display:none;">
                    <div id="msgPagination" class="col-md-4">
                        <div class="dataTables_info" id="divShowingResult">
                            Showing
                            <span id="shStart"> </span> to <span id="shEnd"> </span> of <span id="shTotal"></span>
                            entries
                        </div>
                    </div>
                    <div id="liPagination" class="col-md-8">
                        <ul class="list_pagination">
                        </ul>
                    </div>
                    <ul id="templatePagination" style="display:none;">
                        <li class='liPage' id='0' type="first"> First Page</li>
                        {#Pagination#}
                        <li class='liPage' id='0' type="last"> Last Page</li>
                    </ul>
                </div>
                <div style="display:none;">
                    <table>
                        <tbody id="tbTempHtml">
                            <tr id="{#applicantId#}">
                                <td>{#rowNum#}</td>
                                <td>

                                    <a class="ank" href="/images/Applicant/{#applicantId#}/{#pic#}" target="_blank" title="Click to view"> <img class="imgView" src="/images/Applicant/{#applicantId#}/{#pic#}" /></a>
                                </td>
                                <td class="indc">{#induction#}</td>

                                <td>{#applicantId#}</td>
                                <td>{#name#}</td>
                                <td>{#fatherName#}</td>
                                <td>{#pmdcNo#}  </td>
                                <td>{#emailId#}</td>
                                <td>{#contactNumber#}</td>
                                <td>{#cnicNo#}</td>
                                <td>{#facultyName#}</td>
                                <td class="indc">{#statusType#}</td>
                                <td>{#status#} </td>
                                <td class="displayComments">{#comments#}</td>
                                <td>{#dated#}  </td>
                                <td>{#dateStatus#}</td>
                                <td class="tbRow" appId="{#applicantId#}" indcId="{#inductionId#}">View</td>

                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>