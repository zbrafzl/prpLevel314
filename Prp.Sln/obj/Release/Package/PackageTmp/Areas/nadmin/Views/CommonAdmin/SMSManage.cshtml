@{
    ViewBag.Title = "SMS Manage";
    Layout = "~/Areas/nadmin/Views/Shared/_Layout.cshtml";
}
@model Prp.Sln.EmptyModelAdmin
@section RenderCss{

}
@section RenderScript{

    <script>
        var isSearch = 0; projId = 1, typeId = 0;
        $(document).ready(function () {


            SearchAndBind();

            $(document).on('change', '#ddlProj', function () {
                projId = ConvertToInt($('#ddlProj').val());
                isSearch = 1;
                SearchAndBind();
            });

            $(document).on('click', '.ankSms', function () {

                projId = ConvertToInt($('#ddlProj').val());
                typeId = ConvertToInt($(this).attr("typeId"));

                var obj = {};
                obj.spName = "spSMSRunQueryByTypeId";

                var listParam = [];
                var objParam = {};
                objParam.key = "typeId";
                objParam.value = typeId;
                objParam.dataType = "int";
                listParam.push(objParam);


                obj.listParam = listParam;

                var resp = CallActionPost("/Common/CallSpGenericToMessage", obj);
                if (resp.status) {
                    alert(resp.msg);
                }

            });



        });

        function SearchAndBind() {
            $('#tbBody').append("");
            try {

                var obj = {};
                obj.projId = projId;
                var resp = CallActionPost("/CommonAdmin/SMSSearch", obj);
                if (resp != null) {

                    if (isSearch == 0) {
                        var listProj = resp.Table;
                        DDLBindList("#ddlProj", listProj);
                        $("#ddlProj").val(projId);
                    }

                    var list = resp.Table3;
                    if (list != null && list.length > 0) {
                        var objItem = {}, status = "", clsQuery = "";
                        var htmlSingle = $('#tbRow').html();
                        for (var i = 0; i < list.length; i++) {
                            objItem = list[i];

                            status = "In-Active";
                            if (objItem.isActive == true)
                                status = "Active";

                            clsQuery = "hide";
                            var query = objItem.query;
                            if (query.length > 0 && objItem.isQuery == true) {
                                clsQuery = "show";
                            }

                            var html = htmlSingle.replace(/{#rowNo#}/g, objItem.rowNo)
                                .replace(/{#id#}/g, objItem.id).replace(/{#detail#}/g, objItem.detail)
                                .replace(/{#typeName#}/g, objItem.typeName).replace(/{#typeId#}/g, objItem.typeId)
                                .replace(/{#status#}/g, status).replace(/{#clsQuery#}/g, clsQuery);

                            $('#tbBody').append(html);
                        }
                    }
                }
            } catch (e) {
                htmlAll = "";
            }
        }
    </script>
}
<div class="col-md-12 col-sm-12  ">
    <div class="x_panel">
        <div class="x_title">
            <h2>SMS Manage </h2>
            <div class="panel_toolbox">
                <a href="/admin/sms-setup" class="btn btn-info"> Add New</a>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">
            <form id="demo-form2" data-parsley-validate class="form-horizontal form-label-left">
                <div class="form-group col-lg-12">
                    <div class="col-md-4 col-sm-4 col-xs-4">
                        <label for="heard">Project *:</label>
                        <select id="ddlProj" class="form-control" tabindex="1">
                        </select>
                    </div>
                </div>
            </form>
            <br />
            <div class="table-responsive">
                <table class="table table-striped jambo_table bulk_action">
                    <thead>
                        <tr class="headings">
                            <th class="column-title">Sr </th>
                            <th class="column-title">Type Id </th>
                            <th class="column-title">Type </th>
                            <th class="column-title">Detail </th>
                            <th class="column-title">Status </th>
                            <th>
                                <span class="nobr">Action</span>
                            </th>
                            <th>
                                <span class="nobr">Send SMS</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tbBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div style="display:none;">
    <table>
        <tbody id="tbRow">
            <tr>
                <td>{#rowNo#}</td>
                <td>{#typeId#}</td>
                <td>{#typeName#}</td>
                <td>{#detail#}</td>
                <td>{#status#}</td>
                <td>
                    <a title="Edit Content" class="ank" href="/admin/sms-setup?id={#id#}"><i class="fa fa-pencil-square-o"></i></a>
                </td>
                <td>
                    <a title="Send SMS " class="ank btn btn-info ankSms {#clsQuery#}" typeId="{#typeId#}">Send SMS</a>
                </td>
            </tr>
        </tbody>
        <tbody id="tbNoRecord">
            <tr>
                <td colspan="7" style="text-align:center;">No record found</td>
            </tr>
        </tbody>
    </table>
</div>