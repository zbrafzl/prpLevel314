@{
    ViewBag.Title = "Setup Email Template";
    Layout = "~/Areas/nadmin/Views/Shared/_Layout.cshtml";
}
@model Prp.Sln.EmptyModelAdmin
@section RenderCss{

}
@section RenderScript{

    @*<script src="https://cdn.ckeditor.com/ckeditor5/30.0.0/classic/ckeditor.js"></script>*@
    <script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>



    <script type="text/javascript">

        CKEDITOR.replace('txtDetailCK');

        //var ResultEditor;
        //ClassicEditor
        //    .create(document.querySelector('#ResultEditor'))
        //    .then(editor => {
        //        ResultEditor = editor;
        //    })
        //    .catch(error => {
        //        console.error(error);
        //    });

    </script>

    <script>

        var tempId = 0, typeId = 0;
        $(document).ready(function () {

		     @*try {
                CKFinder.setupCKEditor(null, '@Url.Content("~/ckfinder")');
                var editor = CKEDITOR.instances['txtDetail'];
                if (editor) { editor.destroy(true); }
                CKEDITOR.replace('txtDetail', {
                    enterMode: CKEDITOR.ENTER_BR,
                });
            } catch (e) {
            }*@


            WebUrlToLowerCase();
            tempId = ConvertToInt(GetQuerystringValues("id"));
            typeId = ConvertToInt(GetQuerystringValues("typeid"));

            GetAndBindInfoById();

            $(document).on('change', '#ddlType', function () {
                typeId = ConvertToInt($('#ddlType').val());
                window.location = "/admin/email-template-setup?typeid=" + typeId;
            });

        });



        function GetAndBindInfoById(isBind) {

            try {
                var obj = {};
                obj.tempId = tempId;
                obj.typeId = typeId;
                var resp = CallActionPost("/EmailAndSmsAmin/EmailTemplateGetInfoById", obj);
                if (resp != null) {


                    var listType = resp.Table;
                    DDLBindList("#ddlType", listType);


                    var obj = resp.Table3[0];
                    if (obj != null && obj.tempId > 0) {
                        $("#ddlType").val(obj.typeId);
                        $("#txtTitle").val(obj.title);
                        $("#txtSubject").val(obj.subject);
                        $("#txtDetail").val(obj.body);
                        //ResultEditor.setData(obj.body);
                        $("#chkIsActive").prop("checked", obj.isActive);

                    }

                    if (typeId > 0) {
                        $("#ddlType").val(typeId);
                    }


                }
            } catch (e) {
            }
        }



        function SaveData() {
            try {
                var obj = ValidateFormSMS();
                if (obj.isOk) {
                    var resp = CallActionPost("/EmailAndSmsAmin/EmailTemplateAddUpdate", obj);
                    if (resp != null && resp.status == true) {
                        alert(resp.msg);
                        window.location = "/admin/email-template-manage";
                    }
                    else alert(resp.msg);
                }
            } catch (e) {
            }
        }

        function ValidateFormSMS() {

            var obj = {};
            var isOk = true, ctrl = "";

            try {
                obj.tempId = tempId;
                obj.inductionId = inductionId;
                obj.typeId = ConvertToInt($("#ddlType").val());
                obj.title = ConvertToString($("#txtTitle").val());
                obj.subject = ConvertToString($("#txtSubject").val());
                //obj.body = ConvertToString($("#txtDetail").val());

                obj.body = CKEDITOR.instances.txtDetail.getData();

                //obj.body = ResultEditor.getData();
                obj.isActive = $("#chkIsActive").is(":checked");

                if (obj.name == "") {
                    isOk = false;
                }
                if (obj.subject == "") {
                    isOk = false;
                }
                if (obj.body == "") {
                    isOk = false;
                }

            } catch (e) {
                isOk = false;
            }
            obj.isOk = isOk;
            return obj;
        }

    </script>
}
<div class="col-md-12 col-sm-12  ">
    <div class="x_panel">
        <div class="x_title">
            <h2>Email Template Setup </h2>
            <div class="panel_toolbox">
                <a href="/admin/email-template-manage" class="btn btn-info"> Manage</a>
            </div>
            <div class="clearfix"></div>
        </div>

        <div class="x_content">
            <br />

            <form id="demo-form2" data-parsley-validate class="form-horizontal form-label-left">
                <div class="form-group col-lg-12">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <label for="heard">Type *:</label>
                        <select id="ddlType" class="form-control" tabindex="1">
                        </select>
                    </div>

                </div>
                <div class="form-group col-lg-12">
                    <div class="col-md-5 col-sm-6 col-xs-6">
                        <label for="heard">Title *:</label>
                        <input class="form-control" id="txtTitle" name="txtTitle" required="required" tabindex="2"
                               type="text" value="">
                    </div>
                    <div class="col-md-5 col-sm-6 col-xs-6">
                        <label for="heard">Subject *:</label>
                        <input class="form-control" id="txtSubject" name="txtSubject" required="required" tabindex="3"
                               type="text" value="">
                    </div>
                    <div class="col-md-2 col-sm-2 col-xs-2">
                        <label for="heard">Status *:</label>
                        <input class="form-control" id="chkIsActive" type="checkbox" value="true">

                    </div>
                </div>
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="form-group">
                        <label for="detail" class="form-label required">Detail </label>

                        <div id="ResultEditor">
                            <textarea id="txtDetail" name="txtDetailCK"></textarea>
                        </div>

                        @*<textarea id="txtDetail" rows="10" class="form-control ckeditor" tabindex="4"></textarea>*@

                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="ln_solid"></div>
                <div class="item form-group">
                    <div class="col-md-6 col-sm-6 offset-md-3">
                        <input id="btnSave" class="btn btn-success" type="button" value="Submit" tabindex="5" onclick="SaveData()" />
                    </div>
                </div>

            </form>

        </div>
    </div>
</div>

